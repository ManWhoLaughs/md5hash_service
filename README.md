# md5hash_service

Сервер должен (я надеюсь) работать только на Linux, с Windows слишком много танцев с бубном.

(UPD: Выяснилось, что каким-то образом на некоторых системах может биться кодировка у русских комментариев в питоне, вызывая ошибку. Поэтому все комментарии в коде заменены на английские.)

В работе использовались следующие ключевые модули и фреймворки:
* Flask - для самого сервера и обработки запросов
* RQ и Redis - для реализации очереди асинхронных заданий
* Sqlite3 - для хранения данных всех запросов 
* Flask-mail - для простой отправки сообщений
* requests - для загрузки самого файла

Чтобы всё работало, надо установить сервер Redis

> ***wget http://download.redis.io/redis-stable.tar.gz***
>
> ***tar xvzf redis-stable.tar.gz***
>
> ***cd redis-stable***
>
> ***make***
>
> ***sudo make install***

Оба модуля для Flask, RQ и Redis

> ***pip install flask***
>
> ***pip install flask-mail***
>
> ***pip install rq***
>
> ***pip install redis***
>
> ***pip install requests***

Сама база данных создаётся в корневой директории автоматически при первом запуске сервера.

Написанного человеческим языком вроде должно хватить для запуска, но всё равно, полный набор модулей описан pip-ом и выложен в requirements.txt

Запускается пока руками через три терминала так:

1. В первом терминале просто выполнить redis-server, чтобы создать сервер с очередью задач
2. Во втором терминале перейти в корневую директорию приложения, выполнить rq-worker, чтобы создать исполнителя. (Можно несколько, если не лень)
3. В третьем так же перейти в корневую директорию и запустить run.py с помощью python.

Все настройки портов, кроме почты, оставлены по умолчанию, поэтому вроде не должно быть никаких проблем.

API(назовём гордо):

Как и было сказано в задании, принимаются два типа запросов:
* curl -X POST на <server>/submit с параметром -d, в котором в кавычках находится url и опциональный email
* curl -X GET на <server>/check c аргументами в самом url-адресе в стандартном виде ..../check?id=something
  
Если в POST корректно указан email, то через специальный gmail-ящик на этот адрес отправится оповещение о статусе задачи.
